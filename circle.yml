machine:
  environment:
    BASE_DIR: ${GOPATH%%:*}/src/github.com/${CIRCLE_PROJECT_USERNAME}
    REPO_DIR: ${BASE_DIR}/${CIRCLE_PROJECT_REPONAME}
    GO15VENDOREXPERIMENT: 1

checkout:
  post:
    - mkdir -p ${BASE_DIR}
    - ln -sf $(pwd) ${REPO_DIR}

dependencies:
  override:
    - cd ${REPO_DIR} && go get -t -d -v ./...

test:
  pre:
    - cd ${REPO_DIR} && go vet ./...
  override:
    - cd ${REPO_DIR} && go test -v -race ./...
    - cd ${REPO_DIR} && go test -v -bench . ./...
